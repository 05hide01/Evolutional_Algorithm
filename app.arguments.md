# サンプルコードのコマンドの使い方

本書のサンプルコードのコマンドは、様々なオプション引数を提供しています。オプション引数の値を変更する事で、実験や機能の挙動を細かく変更し、挙動の違いを確認することができます。各章でもサンプルコードのコマンドの使い方を説明していますが、そこで紹介しきれなかった使い方を紹介します。

## 1章で使われているコマンド

### experiments/PPO/run_evogym_ppo.py

このコマンドはEvolution Gym上に仮想生物を表示し、PPOアルゴリズムを用いて動きを学習します。
用意されているオプションは次の通りです。

| オプション                | 短縮表記（abbrev) | デフォルト値    | 詳細                                                                                      |
| -------------------- | ------------ | --------- | --------------------------------------------------------------------------------------- |
| --name               | -n           | “{task}”  | 実験の名前です。デフォルトではタスク名が設定されます。                                                             |
| --task               | -t           | Walker-v0 | タスク名です。デフォルトではWalker-v0タスクが設定されます。                                                      |
| --robot              | -r           | default   | envs/evogym/roboto\\\_files/ ディレクトリ内のファイルで設定しているロボットを指定できます。taskごとにデフォルトのロボットが設定されています。 |
| --num-processes      | -p           | 4         | 並列プロセス数です。デフォルトでは4に設定されています。                                                            |
| -steps               | -s           | 256       | 学習データをサンプリングする回数を設定します。デフォルトでは256に設定されています。                                             |
| --num-mini-batch     | -b           | 8         | バッチサイズです。デフォルトでは8に設定されています。                                                             |
| --epoch              | -e           | 8         | エポック数です。デフォルトでは8に設定されています。                                                              |
| --train-iters        | -i           | 2500      | 学習のイテレーション回数です。デフォルトでは2500に設定してあります。                                                    |
| -evaluation-interval | -ei          | 25        | 学習したポリシーを評価するインターバルです。デフォルトでは、イテレーションが25回実行されるごとにポリシーが評価されるように設定されています。                 |
| -learning-rate       | -lr          | 3e-4      | 強化学習PPOにおける学習率です。デフォルトでは3e-4に設定されています。                                                  |
| -gamma               |              | 0.99      | 適応度の割引率です。デフォルトでは、0.99に設定されています。                                                        |
| -clip-param          | -c           | 0.3       | クリップパラメータです。デフォルトでは0.3に設定されています。                                                        |
| -init-log-std        | -std         | 0.1       | 行動分布の初期対数標準偏差の値です。デフォルトでは0.1に設定されています。                                                  |
| -probabilistic       |              | false     | 学習を確率的に行うためのオプションです。デフォルトでは決定論的（deterministic）に評価されるようになっています。                          |
| -no-view             |              | false     | 評価されたロボットの結果を表示するウィンドウを開かないように設定するオプションです。デフォルトではfalseに設定されておりウィンドウが開くようになっています。        |

ここではバッチサイズを32、エポック数を10、学習率を0.99、適応度の割引率を1e-3で指定し、コマンドを実行します。

```
$ cd リポジトリのルートディレクトリ/experiments/PPO
$ python run_evogym_ppo.py --robot cat --num-mini-batch 32 --epoch 10 --gamma 0.99 --learning-rate 1e-3

```

### experiments/PPO/make_figures.py

このコマンドは`experiments/PPO/run_evogym_ppo.py` で行った実験の結果を可視化するため、画像ファイルを生成します。そのため事前に実験を実行しておく必要があります。
用意されているオプションは次の通りです。

| オプション               | 短縮表記（abbrev) | デフォルト値   | 詳細                                                                                                                                                                 |
| ------------------- | ------------ | -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
|                     |              |          | 可視化する対象のフォルダ名（タスク名\\\\\\\_ロボット名）を指定します。                                                                                                                            |
| --specified         | -s           |          | ロボットIDを指定して結果を作成します。                                                                                                                                               |
| --save-type         | -st          | gif      | gifかjpg形式を指定します。デフォルトはgif形式です。                                                                                                                                     |
| --track-robot       | -rt          | false    | gif形式のみに有効なオプションです。ロボットを画面で追跡した結果を出力します。デフォルトではfalseに設定されており地形全体を写した結果が出力されます。                                                                                     |
| -interval           | -I           | timestep | jpg形式のみに有効なオプションです。timestep か distance を選択することができます。デフォルトはtimestepです。timestep-intervalで指定した時間間隔でロボットが描画されます。distanceを指定すると distance-intervalで指定した距離間隔でロボットが描画されます。 |
| --resolution-scale  | -rs          | 32.0     | jpg形式のみに有効なオプションです。jpg画像サイズを指定します。デフォルトでは32.0です。もし結果が白黒で表示される場合は、この値を変更してみてください。                                                                                   |
| -start-timestep     |              | 0        | jpg形式のみに有効なオプションです。可視化対象とする開始ステップ数です。デフォルトでは0に設定されており、最初から可視化されます。                                                                                                 |
| --timestep-interval | -ti          | 80       | jpg形式のみに有効なオプションです。ロボットを描画する時間間隔（steps数間隔）を指定します。デフォルトは80 stepsごとに描画されます。                                                                                          |
| -blur               | -b           | 0        | jpg形式のみに有効なオプションです。ロボットの残像を描画するtimestepsを指定します。デフォルトは0に設定されており、軌跡は表示されません。                                                                                         |
| -blur-temperature   | -bt          | 0.6      | jpg形式のみに有効なオプションです。残像の残り具合を調整します。0〜1の値を設定できます。デフォルトでは0.6に設定されています。1.0に近いほどすっきりと消え、0.0に近いほどしつこく残ります。                                                                |
| -distance-interval  | -di          | 0.8      | jpg形式のみに有効なオプションです。distanceベースで描画する際の間隔を指定します。デフォルトは0.8です。                                                                                                         |
| -display-timestep   |              | false    | jpg形式のみに有効なオプションです。ロボットを描画したタイミングのtimestepを表示します。デフォルトではfalseに設定されています。表示したい場合はtrueに設定してください。                                                                      |
| -draw-trajectory    |              | false    | jpg形式のみに有効なオプションです。ロボットの重心の軌跡を線で描画します。                                                                                                                             |
| -probabilistic      |              | false    | PPOによる学習を確率的（probabilistic)に行った場合は、trueに設定することで確率的に評価した結果を描画することができます。デフォルトでは決定論的（deterministic）に評価された可視化結果を描画します。                                                 |
| -num-cores          | -c           | 1        | 並列プロセス数です。デフォルトでは1に設定されています。                                                                                                                                       |
| -not-overwrite      |              | false    | 既に描画したロボットIDをスキップして描画するためのオプションです。デフォルトではfalseに設定されています。既にある結果を上書きしたくない場合はtrueに設定してください。                                                                           |
| -no-multi           |              | false    | 並列処理を無効にするオプションです。デフォルトではfalseに設定されています。並列処理に関するエラーが起きた際はtrueに設定してください。                                                                                            |

出力形式により指摘可能なオプションが異なります。

GIFで出力する場合、`--track-robot`を指定すると画面がロボットを追跡した結果を描画できます。

```
$ cd リポジトリのルートディレクトリ/experiments/PPO
$ python make_figures.py --save-type gif --track-robot Walker-v0_cat

```

JPEGで出力する場合、`--draw-trajectory`を指定する事でロボットの重心を描画したり、`--blur`に数値を指定する事で残像を描画できます。

```
$ cd リポジトリのルートディレクトリ/experiments/PPO
$ python make_figures.py --save-type jpg --draw-trajectory --blur 10  Walker-v0_cat
```

## 2章で使われているコマンド

### experiments/NEAT-tutorial/run_circuit.py

このコマンドはNEATアルゴリズムを用いてXOR演算子の挙動を学習する実験を行います。
用意されているオプションは次の通りです。

| オプション        | 短縮表記（abbrev) | デフォルト値   | 詳細                                                            |
| ------------ | ------------ | -------- | ------------------------------------------------------------- |
| --name       | -n           | “{task}” | 実験の名前です。デフォルトではタスク名が設定されます。                                   |
| --task       | -t           | xor      | タスク名です。デフォルトではXOR演算子のタスクが設定されます。                              |
| --pop-size   | -p           | 150      | NEATアルゴリズムの集団数です。デフォルトでは150に設定されています。                         |
| --generation | -g           | 300      | NEATアルゴリズムの世代数です。デフォルトでは300に設定されています。                         |
| -error       | -e           | mse      | 正解との誤差を計算する関数です。デフォルトでは平均二乗誤差に設定されています。他には平均絶対誤差（mae)が設定できます。 |
| --num-cores  | -c           | 4        | 並列プロセス数です。デフォルトでは4に設定されています。                                  |

ここでは集団数を1000、世代数を2000で指定し、コマンドを実行します。

```
cd リポジトリのルートディレクトリ/experiments/NEAT-tutorial
python run_circuit.py --pop-size 1000 --generation 2000 --error mae
```

### experiments/NEAT/run_maze.py

このコマンドはNEATアルゴリズムを用いて迷路を解く実験を行います。
用意されているオプションは次の通りです。

| オプション        | 短縮表記（abbrev) | デフォルト値   | 詳細                                                                                                                                           |
| ------------ | ------------ | -------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| --name       | -n           | “{task}” | 実験の名前です。デフォルトではタスク名が設定されます。                                                                                                                  |
| --task       | -t           | medium   | タスク名です。デフォルトではmeduimの迷路が指定されています。hardも指定可能です（envs/maze/maze\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_files/以下のファイルを指定） |
| --pop-size   | -p           | 500      | NEATアルゴリズムの集団数です。デフォルトでは500に設定されています。                                                                                                        |
| --generation | -g           | 500      | NEATアルゴリズムの世代数です。デフォルトでは300に設定されています。                                                                                                        |
| -timestep    |              | 400      | 1回の実行でロボットが動くことのできるステップ数です。デフォルトでは400に設定してあります。値が大きいほど長い距離をロボットは動くことができます。                                                                   |
| --num-cores  | -c           | 4        | 並列プロセス数です。デフォルトでは4に設定されています。                                                                                                                 |
| -no-plot     |              | false    | 一世代の実行が終わる度に迷路とロボットの辿った軌跡が表示されます。表示させたくない場合は-no-plotを指定して実行してください。                                                                           |

ここでは集団数を100、世代数を200、ロボットが1回の実行で動くステップ数を500で指定し、コマンドを実行します。

```
cd リポジトリのルートディレクトリ/experiments/NEAT/run_maze.py
python run_maze.py --pop-size 100 --generation 200 --timestep 500
```

### experiments/NEAT/run_evogym.py

このコマンドはEvolution Gym上に仮想生物を表示し、NEATアルゴリズムを用いて動きを学習します。
用意されているオプションは次の通りです。

| オプション        | 短縮表記（abbrev) | デフォルト値    | 詳細                                                                                                                                                     |
| ------------ | ------------ | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| --name       | -n           | “{task}”  | 実験の名前です。デフォルトではタスク名\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_ロボット名が設定されます。                                                       |
| --task       | -t           | Walker-v0 | タスク名です。デフォルトではWalker-v0タスクが指定されています。                                                                                                                   |
| -robot       | -r           | cat       | ロボットの形態です。デフォルトでは、猫型の形態 cat が設定されています。ロボットの形態は、envs/evogym/robot\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\_files/ディレクトリに保存されています。 |
| --pop-size   | -p           | 200       | NEATアルゴリズムの集団数です。デフォルトでは200に設定されています。                                                                                                                  |
| --generation | -g           | 500       | NEATアルゴリズムの世代数です。デフォルトでは500に設定されています。                                                                                                                  |
| -eval-num    |              | 1         | 評価回数です。デフォルトでは1に設定されています。Catcher-v0だけは物体の落ちてくる位置が毎回異なっているため評価回数を増やしてください。                                                                              |
| --num-cores  | -c           | 4         | 並列プロセス数です。デフォルトでは4に設定されています。                                                                                                                           |
| -no-view     |              | false     | 一世代の実行が終わる度に最大適応度の結果が表示されます。表示させたくない場合は-no-viewを指定して実行してください。                                                                                          |

ここでは集団数を100、世代数を40で指定し、コマンドを実行します。

```
$ cd リポジトリのルートディレクトリ/experiments/NEAT
$ python run_evogym.py --pop-size 100 --generation 40
```

## 3章で使われているコマンド

### experiments/NoveltySearch/run_maze.py

このコマンドは新規性探索アルゴリズムを用いて迷路を解く実験を行います。

用意されているオプションは次の通りです。

| オプション         | 短縮表記（abbrev) | デフォルト値   | 詳細                                                                   |
| ------------- | ------------ | -------- | -------------------------------------------------------------------- |
| --name        | -n           | “{task}” | 実験の名前です。デフォルトではタスク名が設定されます。                                          |
| --task        | -t           | medium   | 迷路の名前です。"envs/maze/maze\\\\\\\_files/" ディレクトリ内のファイルで設定している迷路を指定できます。 |
| --pop-size    | -p           | 500      | NEATアルゴリズムの集団数です。デフォルトでは200に設定されています。                                |
| --generation  | -g           | 500      | NEATアルゴリズムの世代数です。デフォルトでは500に設定されています。                                |
| --ns-treshold |              | 6.0      | 新規性のアーカイブに追加する初期値の閾値です。                                              |
| --num-knn     |              | 15       | 新規性を計算する最近傍のエージェント数です。                                               |
| --mcns        |              | 0.01     | 最低限満たすべき適応度です。この値を下回った個体は死にます。                                       |
| --timestep    |              | 400      | ロボット（エージェント）のステップ数です。                                                |
| --num-cores   | -c           | 4        | 並列プロセス数です。デフォルトでは4に設定されています。                                         |
| -no-plot      |              | false    | 途中結果を表示するオプションです。デフォルトではfalseに設定されているので、非表示にしたい場合は、このオプションをつけてください。  |

ここでは難易度中のタスク、集団数を100、ロボットのステップ数を500で指定し、コマンドを実行します。

```
cd リポジトリのルートディレクトリ/experiments/NoveltySearch/
python run_maze.py --task medium --pop-size 100 --timestep 500
```

### experiments/NoveltySearch/run_evogym.py

このコマンドはEvolution Gym上に仮想生物を表示し、新規性探索アルゴリズムを用いて動きを学習します。
用意されているオプションは次の通りです。

| オプション         | 短縮表記（abbrev) | デフォルト値    | 詳細                                                                                                                                           |
| ------------- | ------------ | --------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| --name        | -n           | “{task}”  | 実験の名前です。デフォルトではタスク名が設定されます。                                                                                                                  |
| --task        | -t           | Walker-v0 | タスク名です。デフォルトではWalker-v0タスクが設定されます。                                                                                                           |
| --robot       | -r           | cat       | "envs/evogym/roboto\\\\\\\_files/" ディレクトリ内のファイルで設定しているロボットを指定できます。デフォルトではcat型のロボットが設定されます。”default”と指定した場合は、ロボットごとに指定されているデフォルトのロボットが設定されます。 |
| --pop-size    | -p           | 200       | NEATアルゴリズムの集団数です。デフォルトでは200に設定されています。                                                                                                        |
| --generation  | -g           | 500       | NEATアルゴリズムの世代数です。デフォルトでは500に設定されています。                                                                                                        |
| --ns-treshold |              | 0.1       | 新規性のアーカイブに追加する初期値の閾値です。                                                                                                                      |
| --num-knn     |              | 5         | 新規性を計算する最近傍のエージェント数です。                                                                                                                       |
| --mcns        |              | 0.0       | 最低限満たすべき適応度です。この値を下回った個体は死にます。                                                                                                               |
| -eval-num     |              | 1         | ロボット（エージェント）の評価回数です。デフォルトでは1に設定されています。Cathcer-v0タスクは物体の落ちてくる一が毎回異なるため評価回数を増やす方がいいです。                                                         |
| --num-cores   | -c           | 4         | 並列プロセス数です。デフォルトでは4に設定されています。                                                                                                                 |
| -no-view      |              | false     | 途中結果を表示するオプションです。デフォルトではfalseに設定されているので、非表示にしたい場合は、このオプションをつけてください。                                                                          |

ここでは難易度中のタスク、集団数を100、ロボットのステップ数を500で指定し、コマンドを実行します。

```
$ cd リポジトリのルートディレクトリ/experiments/NoveltySearch
$ python run_evogym.py -r cat --pop-size 100 --ns-threshold 0.5 --num-knn 10 --mcns 0.3
```

## 4章で使われているコマンド

### experiments/QualityDiversity/run_evogym_cppn.py

このコマンドはEvolution Gym上に仮想生物を表示し、品質多様性アルゴリズムを用いて動きを学習します。

実験を開始するには次のコマンドを実行します。

```
$ cd リポジトリのルートディレクトリ/experiments/QualityDiversity
$ python run_evogym_cppn.py
```

<!--
CPPN
  | ハイパーパラメータ | 英語                      | 説明                                                                                             |
  |--------------------+---------------------------+--------------------------------------------------------------------------------------------------|
  | ノード数           | Number of Nodes           | ネットワーク内のノードの数。                                                                     |
  | 隠れ層の数         | Number of Hidden Layers   | ネットワーク内の隠れ層の数。                                                                     |
  | 活性化関数         | Activation Function       | ノードで使用される活性化関数の種類。例：sigmoid、tanh、ReLUなど                                  |
  | 接続密度           | Connection Density        | ネットワーク内の接続数の密度。                                                                   |
  | 初期接続重み       | Initial Connection Weight | ネットワーク内の接続の初期重み。                                                                 |
  | 進化アルゴリズム   | Evolution Algorithm       | 使用される進化アルゴリズム。例：NEAT、CEC、GAなど                                                |
  | 突然変異率         | Mutation Rate             | 個体が突然変異する確率。突然変異は新しい遺伝子情報を導入することができます。                     |
  | 交叉率             | Crossover Rate            | 2つの親個体が子孫個体を生成する際に、どの程度交叉を行うかを調整するパラメータ。                  |
  | 分類のパラメータ   | Speciation Parameters     | NEATアルゴリズムを使用する場合に使用される、分類のパラメータ。例：閾値、遺伝子の類似性の定義など |

Quality Diversity
  | ハイパーパラメータ     | 英語                               | 説明                                                                                                                                             |
  |------------------------+------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------|
  | 個体数                 | Population size                    | アルゴリズムが保持する個体数。                                                                                                                   |
  | 選択方法               | Selection method                   | 個体の選択方法。例：エリート選択、ルーレット選択、トーナメント選択など                                                                           |
  | 突然変異率             | Mutation rate                      | 個体が突然変異する確率。突然変異は新しい遺伝子情報を導入することができます。                                                                     |
  | 交叉率                 | Crossover rate                     | 2つの親個体が子孫個体を生成する際に、どの程度交叉を行うかを調整するパラメータ。                                                                  |
  | 新規性閾値             | Novelty threshold                  | 個体の新規性を評価するための閾値。この閾値を下回る個体は、QDアルゴリズムにとって「似たもの」として扱われます。                                   |
  | 新規性アーカイブサイズ | Novelty archive size               | QDアルゴリズムが保持する新規性個体のアーカイブサイズ。                                                                                           |
  | 行動特性の評価方法     | Behavioral characterization method | 個体の行動特性を評価するための方法。例えば、シミュレーション環境内でのパフォーマンス、行動の多様性、または他の個体との相互作用などが含まれます。 |
  | 選択圧                 | Selection pressure                 | 選択の際に、優れた個体をどの程度優先するかを調整するパラメータ。                                                                                 |
  | 目的関数               | Objective function                 | アルゴリズムが最適化する目的関数。多目的最適化にも使用されます。                                                                                 |

-shape
-batch-size
-pop-iters
-evaluation-interval
-->

その他、用意されているオプションは次の通りです。

| オプション                | 短縮表記（abbrev) | デフォルト値    | 詳細                                                                                           |
| -------------------- | ------------ | --------- | -------------------------------------------------------------------------------------------- |
| --name               | -n           | “{task}”  | 実験の名前です。デフォルトではタスク名が設定されます。                                                                  |
| --task               | -t           | Walker-v0 | タスク名です。デフォルトではWalker-v0タスクが設定されます。                                                           |
| -shape               | -s           | (5,5)     | ロボットサイズを指定します。デフォルトは5x5です。-s {height} {widht}で高さと幅を指定できます。                                   |
| -batch-size          | -b           | 4         | 各世代で評価する個体の数です。デフォルトでは4つの個体が1つの世代で評価されます。                                                    |
| --generation         | -g           | 500       | CPPN NEATアルゴリズムで形態を進化させる世代数です。デフォルトでは500に設定されています。                                           |
| -pop-iters           | -i           | 500       | PPOアルゴリズムの評価回数です。デフォルトでは500に設定してありますが、複雑なタスクにはより多く必要です。                                      |
| -evaluation-interval | -ei          | 20        | ポリシーを評価するインターバルです。デフォルトでは20に設定してあります。                                                        |
| -deterministic       | -d           | false     | エージェントの評価を決定論的に行います。デフォルトはprobabilistic（確率的）です。決定論的（deterministic）に評価したいときは、このオプションをつけてください。 |
| --num-cores          | -c           | 1         | 並列プロセス数です。デフォルトでは1に設定されています。                                                                 |
| -no-plot             |              | false     | BD Mapの途中結果を表示するオプションです。デフォルトではfalseに設定されているので、非表示にしたい場合は、このオプションをつけてください。                   |
| -no-view             |              | false     | 各世代のベストな個体を示すオプションです。デフォルトではfalseに設定されているので、非表示にしたい場合は、このオプションをつけてください。                      |

## 5章で使われているコマンド

### experiments/MinimalCriterioCoevolution/bootstrap_maze.py

MCCアルゴリズムで迷路を解く実験のための初期集団として、迷路とエージェントを作成します。

作成を開始するには次のコマンドを実行します。

```
cd リポジトリのルートディレクトリ/experiments/MinimalCriterioCoevolution/
python run_maze.py --pop-size 1000 --generation 2000 --timestep 800
```

<!--
CPPN
  | ハイパーパラメータ | 英語                      | 説明                                                                                             |
  |--------------------+---------------------------+--------------------------------------------------------------------------------------------------|
  | ノード数           | Number of Nodes           | ネットワーク内のノードの数。                                                                     |
  | 隠れ層の数         | Number of Hidden Layers   | ネットワーク内の隠れ層の数。                                                                     |
  | 活性化関数         | Activation Function       | ノードで使用される活性化関数の種類。例：sigmoid、tanh、ReLUなど                                  |
  | 接続密度           | Connection Density        | ネットワーク内の接続数の密度。                                                                   |
  | 初期接続重み       | Initial Connection Weight | ネットワーク内の接続の初期重み。                                                                 |
  | 進化アルゴリズム   | Evolution Algorithm       | 使用される進化アルゴリズム。例：NEAT、CEC、GAなど                                                |
  | 突然変異率         | Mutation Rate             | 個体が突然変異する確率。突然変異は新しい遺伝子情報を導入することができます。                     |
  | 交叉率             | Crossover Rate            | 2つの親個体が子孫個体を生成する際に、どの程度交叉を行うかを調整するパラメータ。                  |
  | 分類のパラメータ   | Speciation Parameters     | NEATアルゴリズムを使用する場合に使用される、分類のパラメータ。例：閾値、遺伝子の類似性の定義など |

Quality Diversity
  | ハイパーパラメータ     | 英語                               | 説明                                                                                                                                             |
  |------------------------+------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------|
  | 個体数                 | Population size                    | アルゴリズムが保持する個体数。                                                                                                                   |
  | 選択方法               | Selection method                   | 個体の選択方法。例：エリート選択、ルーレット選択、トーナメント選択など                                                                           |
  | 突然変異率             | Mutation rate                      | 個体が突然変異する確率。突然変異は新しい遺伝子情報を導入することができます。                                                                     |
  | 交叉率                 | Crossover rate                     | 2つの親個体が子孫個体を生成する際に、どの程度交叉を行うかを調整するパラメータ。                                                                  |
  | 新規性閾値             | Novelty threshold                  | 個体の新規性を評価するための閾値。この閾値を下回る個体は、QDアルゴリズムにとって「似たもの」として扱われます。                                   |
  | 新規性アーカイブサイズ | Novelty archive size               | QDアルゴリズムが保持する新規性個体のアーカイブサイズ。                                                                                           |
  | 行動特性の評価方法     | Behavioral characterization method | 個体の行動特性を評価するための方法。例えば、シミュレーション環境内でのパフォーマンス、行動の多様性、または他の個体との相互作用などが含まれます。 |
  | 選択圧                 | Selection pressure                 | 選択の際に、優れた個体をどの程度優先するかを調整するパラメータ。                                                                                 |
  | 目的関数               | Objective function                 | アルゴリズムが最適化する目的関数。多目的最適化にも使用されます。                                                                                 |

MCC
  | ハイパーパラメータ     | 英語                           | 説明                                                                                            |
  |------------------------+--------------------------------+-------------------------------------------------------------------------------------------------|
  | 個体数                 | Population size                | アルゴリズムが保持する個体数。                                                                  |
  | 世代数                 | Generation count               | アルゴリズムが進化する世代の数。                                                                |
  | 突然変異率             | Mutation rate                  | 個体が突然変異する確率。突然変異は新しい遺伝子情報を導入することができます。                    |
  | 交叉率                 | Crossover rate                 | 2つの親個体が子孫個体を生成する際に、どの程度交叉を行うかを調整するパラメータ。                 |
  | 突然変異確率           | Mutation probability           | 個体の各遺伝子が突然変異する確率。                                                              |
  | 入力数                 | Number of inputs               | 個体に入力として提供されるデータの数。                                                          |
  | 出力数                 | Number of outputs              | 個体が出力するデータの数。                                                                      |
  | 木の深さの上限         | Max tree depth                 | 個体の表現に使用される木構造の深さの最大値。                                                    |
  | 染色体の数             | Number of chromosomes          | 個体に含まれる染色体の数。                                                                      |
  | 染色体あたりのノード数 | Number of nodes per chromosome | 個体の各染色体に含まれるノードの数。                                                            |
  | 活性化関数             | Activation function            | 個体のノードで使用される活性化関数の種類。                                                      |
  | 適応度関数             | Fitness function               | アルゴリズムが最適化する目的関数。MCCアルゴリズムは、回帰、分類、制御などの問題に適用できます。 |


-->

その他、用意されているオプションは次の通りです。

| オプション             | 短縮表記（abbrev) | デフォルト値  | 詳細                                           |
| ----------------- | ------------ | ------- | -------------------------------------------- |
| --name            | -n           | default | 作成する初期集団の名前です。デフォルトでは”default”が設定されています。     |
| --agent-num       |              | 20      | 初期集団で用意するエージェント数です。デフォルトでは20に設定されています。       |
| --maze-num        |              | 10      | 初期集団で用意する迷路の数です。デフォルトでは10に設定されています。          |
| --wall-gene-num   |              | 2       | 迷路の「壁」の初期数です。デフォルトでは2に設定されています。              |
| --path-gene-num   |              | 2       | 迷路の「経路」の初期数です。デフォルトでは2に設定されています。             |
| --exit-range      |              | 5.0     | ゴールに到達したかを判断するための範囲です。デフォルトでは5.0に設定されています。   |
| -radius           |              | 5.0     | エージェントの半径です。デフォルトでは5.0に設定されています。             |
| --range-finder    |              | 100.0   | エージェントが見渡せる範囲です。デフォルトでは100.0に設定されています。       |
| --max-speed       |              | 5.0     | エージェントの最高スピードです。デフォルトでは5.0に設定されています。         |
| --max-angular-vel |              | 8.0     | エージェントの最大角速度です。デフォルトでは8.0に設定されています。          |
| --speed-scale     |              | 2.0     | ニューラルネットワークの速度に関する出力です。デフォルトでは2.0に設定されています。  |
| --angular-scale   |              | 3.0     | ニューラルネットワークの角速度に関する出力です。デフォルトでは3.0に設定されています。 |
| -num-cores        | -c           | 4       | 並列プロセス数です。デフォルトでは4に設定されています。                 |

### experiments/MinimalCriterioCoevolution/run_maze.py

このコマンドはMCCアルゴリズムを用いて迷路を解く実験を行います。

実験を開始するには次のコマンドを実行します。

```
cd リポジトリのルートディレクトリ/experiments/MinimalCriterioCoevolution/
python run_maze.py --pop-size 1000 --generation 2000 --timestep 800
```

<!--
  | ハイパーパラメータ     | 英語                           | 説明                                                                                            |
  |------------------------+--------------------------------+-------------------------------------------------------------------------------------------------|
  | 個体数                 | Population size                | アルゴリズムが保持する個体数。                                                                  |
  | 世代数                 | Generation count               | アルゴリズムが進化する世代の数。                                                                |
  | 突然変異率             | Mutation rate                  | 個体が突然変異する確率。突然変異は新しい遺伝子情報を導入することができます。                    |
  | 交叉率                 | Crossover rate                 | 2つの親個体が子孫個体を生成する際に、どの程度交叉を行うかを調整するパラメータ。                 |
  | 突然変異確率           | Mutation probability           | 個体の各遺伝子が突然変異する確率。                                                              |
  | 入力数                 | Number of inputs               | 個体に入力として提供されるデータの数。                                                          |
  | 出力数                 | Number of outputs              | 個体が出力するデータの数。                                                                      |
  | 木の深さの上限         | Max tree depth                 | 個体の表現に使用される木構造の深さの最大値。                                                    |
  | 染色体の数             | Number of chromosomes          | 個体に含まれる染色体の数。                                                                      |
  | 染色体あたりのノード数 | Number of nodes per chromosome | 個体の各染色体に含まれるノードの数。                                                            |
  | 活性化関数             | Activation function            | 個体のノードで使用される活性化関数の種類。                                                      |
  | 適応度関数             | Fitness function               | アルゴリズムが最適化する目的関数。MCCアルゴリズムは、回帰、分類、制御などの問題に適用できます。 |

--agent-criterion
--maze-criterion
--agent-pop
--maze-pop
--agent-limit
--maze-limit
--agent-batch
--maze-batch
-print-maze
-->

その他、用意されているオプションは次の通りです。

| オプション             | 短縮表記（abbrev) | デフォルト値      | 詳細                                                       |
| ----------------- | ------------ | ----------- | -------------------------------------------------------- |
| --name            | -n           | “bootstrap” | 実験の名前です。デフォルトでは--bootstrapオプションで指定された名前が使われます。           |
| --bootstrap       | -b           | default     | 初期集団を指定します。デフォルトでは「default」という名前の迷路とエージェントの初期集団が読み込まれます。 |
| --generation      | -g           | 1000        | 実行する世代数です。デフォルトでは1000が設定されています。                          |
| --agent-criterion |              | 1           | エージェントが生き残るために必要な迷路の解答数。デフォルトでは1が設定されています。               |
| --maze-criterion  |              | 1           | 迷路が生き残るために必要なエージェントの解答数。デフォルトでは1が設定されています。               |
| --agent-pop       |              | 160         | エージェント集団の最大数。デフォルトでは160が設定されています。                        |
| --maze-pop        |              | 40          | 迷路集団の最大数。デフォルトでは40が設定されています。                             |
| --agent-limit     |              | 0           | エージェント資源の制限数。デフォルトでは0が設定されています。0は制限が無いことを示します。           |
| --maze-limit      |              | 4           | 迷路資源の制限数。デフォルトでは4が設定されています。4つのエージェントに迷路が解かれると資源を使い切ります。  |
| --agent-batch     |              | 40          | 一世代で評価される最大のエージェント数です。デフォルトでは40が設定されています。                |
| --maze-batch      |              | 10          | 一世代で評価される最大の迷路数です。デフォルトでは10が設定されています。                    |
| --num-cores       | -c           | 4           | 並列プロセス数です。デフォルトでは4に設定されています。                             |
| -print-maze       |              | false       | 一世代ごとに生き残った迷路の詳細を画面に表示します。デフォルトでは非表示になっています。             |

## 6章で使われているコマンド

### experiments/POET/run_evogym_poet.py

このスクリプトはEvolution Gym上に仮想生物を表示し、POETを用いて学習します。
実験を開始するには次のコマンドを実行します。

```
cd リポジトリのルートディレクトリ/experiments/POET
python run_evogym_poet.py
```

<!--
  | ハイパーパラメータ | 英語                    | 説明                                                                    |
  |--------------------+-------------------------+-------------------------------------------------------------------------|
  | 最大世代数         | Max generations         | アルゴリズムが進化する最大世代数。                                      |
  | 新規性の閾値       | Novelty threshold       | 進化計算の過程で新規性を測定するために使用される閾値。                  |
  | 最大種の数         | Max species             | アルゴリズムで維持される最大種の数。                                    |
  | 最大個体数         | Max population          | 一つの種内で許容される最大個体数。                                       |
  | アーカイブのサイズ | Archive size            | 新規性の高い個体を保存するアーカイブのサイズ。                          |
  | 複雑性の閾値       | Complexity threshold    | 個体の複雑性を測定するための閾値。                                      |
  | 変更の閾値         | Delta threshold         | 進化計算の過程で使用される個体の遺伝子情報の差異を評価する閾値。        |
  | 追加率             | Add rate                | 新しい種を生成するための個体の追加率。                                  |
  | 削除率             | Delete rate             | 種を削除するための種内個体の削除率。                                    |
  | 乱数振動率         | Perturb rate            | 個体の遺伝子情報を変更する際の乱数振動率。                              |
  | 乱数振幅           | Perturb magnitude       | 個体の遺伝子情報を変更する際の乱数振幅の大きさ。                        |
  | 互換性の閾値       | Compatibility threshold | 2つの個体が同じ種に属するかどうかを評価する際に使用される互換性の閾値。 |
  | 適応度の閾値       | Fitness threshold       | アルゴリズムが進化するために必要な適応度の閾値。                        |

-niche-num
-reproduce-num
-admit-child-num
-reproduce-interval
-transfer-interval
-reproduce-threshold
-mc-lower
-mc-upper
-width
-steps-per-iteration
-learning-rate
-epoch
-num-mini-batch
-clip-param
-steps
-->

その他、用意されているオプションは次の通りです。

| オプション                | 短縮表記（abbrev) | デフォルト値    | 詳細                                                                                                                                                                              |
| -------------------- | ------------ | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| --name               | -n           | default   | 実験の名前です。デフォルトでは”default”が設定されています。                                                                                                                                              |
| -task                | -t           | Parkou-v0 | タスクを指定します。Parkou-v0とParkou-v1の指定が可能です。デフォルトではParkou-v0が指定されています。                                                                                                                |
| -robot               | -r           | cat       | エージェントの形態を与えます。デフォルトでは猫のような形の形態が与えられます。"envs/evogym/robot\\\_files/“以下に保存しているファイルを入力として与えることができます。                                                                              |
| -iteration           | -i           | 3000      | イテレーションの数です。デフォルトでは3,000に設定してあります。                                                                                                                                              |
| -niche-num           | -n-num       | 10        | 保持するnicheの最大数です。デフォルトでは10に設定してあります。                                                                                                                                             |
| -reproduce-num       | -r-num       | 10        | 1回のイテレーションで作る「候補子孫」の数です。デフォルトでは10に設定してあります。                                                                                                                                     |
| -admit-child-num     | -ac-num      | 1         | 新たに集団に加えるniche数です。デフォルトでは1に設定してあります。                                                                                                                                            |
| -reproduce-interval  | -r-iv        | 30        | 子孫を作る間隔です。デフォルトでは30イテレーション毎に子孫を作ります。                                                                                                                                            |
| -transfer-interval   | -t-iv        | 15        | エージェントを転送させる間隔です。デフォルトでは15イテレーション毎に転送させます。                                                                                                                                      |
| -save-interval       | -s-iv        | 0         | 行動学習の途中経過を保存するインターバルです．これとは別にスコアが最大のときのものを上書きで保存していきます．途中経過を使用して分析（可視化）するということがなければデフォルトの0（no save）でよいです．                                                                       |
| -reproduce-threshold | -r-th        | 0.5       | 新しい環境を作る候補となる環境の生成を制限するための閾値です。タスクに設定された最大スコアに対する割合を表します。既存のnicheによるスコアがこの値を上回ったときのみ新しい環境が生成されます。デフォルトでは、0.5に設定してあります。タスクに設定された最大スコアは10のため、既存のnicheによるスコアが5を超えないと新しい環境はつくられません。 |
| -mc-lower            | -mc-l        | 0.1       | 新しく作られた環境を集団に加えるか否かを決める閾値の最低スコア比率です。このスコアを下回っている環境は、現在の集団のエージェントにとって簡単すぎる環境と判断され、集団に加えられません。デフォルトでは0.1に設定してあります。mc-lowerスコアをより小さく設定すると、より簡単な環境でも集団に加えられるようになります。                |
| -mc-upper            | -mc-u        | 0.8       | 新しく作られた環境を集団に加えるか否かを決める閾値の最高スコア比率です。このスコアを上回っている環境は、現在の集団のエージェントにとって難しすぎる環境と判断され、集団に加えられません。デフォルトでは0.8に設定してあります。mc-upperスコアをより大きく設定すると、より難しい環境でも集団に加えられるようになります。                |
| -width               | -w           | 100       | Evogymにおける地面の長さを設定します。デフォルトでは100に設定してあります。長い設定するほど、長い環境が用意されます。                                                                                                                 |
| -first-platform      | -fp          | 10        | Evogymの最初の平坦な足場の最低保証の長さになります．最初から穴や段差がないようにするためのものです．一応オプションにしまたが，変更して結果が面白く変わるものでもないはずです．                                                                                      |
| -steps-per-iteration | -si-ppo      | 4         | POETの一度のiterationでPPOの学習を何回繰り返す（進める）かということを指定しています．POETの（学習の）進行速度に関わります．評価にも時間がかかることと，transfer時にシミュレーション1周分（500 timestep）は学習させたいこともあり，4（4\\\*128で1周分の500を超える）をデフォルトとしています。      |
| -learning-rate       | -lr-ppo      | 2.5e-4    | 強化学習PPOにおける学習率です。デフォルトでは2.5e-4に設定されています。                                                                                                                                        |
| -epoch               | -e-ppo       | 4         | 強化学習PPOにおけるエポック数です。デフォルトでは4に設定されています。                                                                                                                                           |
| -num-mini-batch      | -b-ppo       | 4         | 強化学習PPOにおけるバッチ数です。デフォルトでは4に設定されています。                                                                                                                                            |
| -clip-param          | -c-ppo       | 0.1       | 強化学習PPOにおけるクリップパラメータです。デフォルトでは0.1に設定されています。                                                                                                                                     |
| -steps               | -s-ppo       | 128       | PPOはシミュレーションをn回stepして学習データをサンプリングし，--epoch 回数--num-mini-batchでそのデータを学習します．これを繰り返していくのがPPOです．このときのnが--steps です。                                                                  |
| -num-processes       | -p-ppo       | 4         | 強化学習PPOにおける並列プロセス数です。デフォルトでは4に設定されています。                                                                                                                                         |
| -num-cores           | -c           | 4         | 並列プロセス数です。デフォルトでは4に設定されています。                                                                                                                                                    |
